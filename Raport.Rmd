---
title: "Co wpływa na długość naszego życia?"
author: "Szymon Malec, Michał Wiktorowski"
output:
  pdf_document: 
    extra_dependencies: ["polski", "mathtools", "amsthm", "amssymb", "icomma", "upgreek", "xfrac", "scrextend", "float", "tabularx", "hyperref", "caption", "enumitem"]
---

\renewcommand{\figurename}{Wykres}
\renewcommand{\tablename}{Tablica}
\raggedbottom

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, eval = TRUE)
```

```{r}
library(ggplot2)
library(dplyr)
library(zeallot)
library(tidyr)
library(knitr)

data <- read.csv("data/data.csv")
```


# Wstęp
<!-- Akapit - 6 spacji -->
|      W niniejszej pracy chcielibyśmy przeanalizować, jak poszczególne czynniki zewnętrzne wpływają na długość naszego życia. Jak się okazuje, jedne z nich są poważnym problemem, podczas gdy inne w niewielkim stopniu przyczyniają się na długość życia. Do analizy posłużymy się zbiorem danych charakteryzującym wiele państw świata pod kilkoma aspektami, między innymi takimi jak jakość edukacji, spożycie alkoholu, czy zapadalność na poszczególne choroby. Link do danych znajduje się [$\color{blue}{\text{tutaj}}$](https://www.kaggle.com/datasets/kumarajarshi/life-expectancy-who?fbclid=IwAR2HtwUPyioM4tHmuae7B2owTUB8q3XlmpP12LbTM9NYDsi4qtaWGOYoNDE).


# Opis danych


# Braki w danych
|      Zanim rozpoczniemy analizować nasze dane, sprawdźmy, czy zawierają one jakieś braki.

```{r}
knitr::opts_chunk$set(fig.width=6, fig.height=9)

nans <- data.frame()
years <- sort(unique(data$year))
for (y in years) {
    data_year <- data %>% filter(year == y)
    ns <- c()
    for (column in colnames(data_year[4:22])) {
        n <- sum(is.na(data_year[column]))
        ns <- append(ns, n)
    }
    nans <- rbind(nans, ns)
}
nans <- cbind(years, nans)
names(nans) <- colnames(data[c(2, 4:22)])
df <- data.frame(t(nans))
names(df) <- lapply(df[1, ], as.character)
df <- df[-1,1:16]
kable(df)
```


# Devoloped a developing
|      Jak wspomnieliśmy wyżej, dane są podzielone na dwie kategorie. Jedna z nich o nazwie 'developed' reprezentuje państwa wysoko rozwinięte. Natomiast drugą kategorią jest 'developing' i stanowi państwa słabiej rozwinięte. Są w niej zawaarte głównie państwa afrykańskie. Jako że poszczególne dane pośród tych dwóch kategorii mogą się zasadniczo różnić, przeanalizujemy je z osobna.

|      Spodziewamy się, że w krajach lepiej rozwiniętych średnia długość życia jest dłuższa niż w krajach uboższych. żeby przekonać się, czy w rzeczywistości tak jest, 


# Analiza
|      Aby przeanalizować, co najbardziej wpływa na długość życia, musimy sprawdzić czy poszczególne zbiory danych są od siebie zależne, czy występuje między nimi pewna korelacja. W tym celu posłużymy się wykresami punktowymi i na ich podstawie wybierzemy odpowiednie narzędzia do badania korelacji.


```{r wykresik, fig.cap="\\label{fig:wykresik} Wykressss", fig.align="center"}
data[4:22] %>%
  gather(-life_expectancy, key = "var", value = "value") %>% 
  ggplot(aes(x = value, y = life_expectancy)) +
    geom_point(size=0.4, alpha=0.4, col='#0575d0', stroke=0) +
    facet_wrap(~ var, scales='free', nrow=6) + 
  ggtitle("Wykresikiii") + 
  scale_x_discrete() + 
  scale_y_discrete() + theme(
  plot.title = element_text(hjust = 0.5, size = 24),
)
```


Od razu możemy zauważyć, że rozrzut punktów na poszczególnych wykresach jest bardzo zróżnicowany. Na jednych wydaje się on być całkowicie losowy, natomiast na innych widać pewną zależność. Ze względu na to zróżnicowanie, nie użyjemy do sprawdzenia korelacji współczynnika Pearsona - sprawdza on jedynie zależność liniową. Można za to wykorzystać współczynnik korelacji Spearmana, który sprawdza zależność monotoniczną między danymi. Ze względu na silną korelację, poddamy głębszej analizie dwa czynniki - długość edukacji, oraz produkt krajowy brutto.

### Edukacja
### PKB


# Polska


# Jak długo żyją inni?
|      Jak już wspomnieliśmy - długość życia zależy od wielu czynników i dla każdego państwa na świecie inaczej się one charakteryzują. Rozważmy na początku dane z 2015 roku - najnowsze, którymi dysponujemy. Średnia długość życia na globie wyniosła wtedy 71,62 lata. Jednak rozrzut danych dla poszczególnych państw jest duży. Mianem najdłużej żyjących ludzi mogli się wtedy poszczycić Słoweńczycy z imponującą średnią życia aż 88 lat. Natomiast najkrócej żyjącymi ludźmi okazali się być obywatele Sierra Leony z wynikiem zaledwie 51 lat. Polacy osiągneli wynik 77.5 lat, co stawia nas na 42 miejscu w rankingu - wynik dobry, ale nie najlepszy.

\begin{figure}[H]
```{r, echo = FALSE, fig.width = 5, fig.height = 4, fig.align="center"}

#średnia długość życia dla państw
df <- data[data$year == 2015,]
df <- arrange(df, desc(life_expectancy))

bar2 <- ggplot(data = rbind(head(df, 5), df[df$country == 'Poland',], tail(df, 5)), mapping = aes(reorder(country, -life_expectancy, sum), life_expectancy)) + 
  geom_bar(stat = 'identity', fill = c('light green', 'light green', 'light green', 'light green', 'light green', 'gold', 'orangered', 'orangered', 'orangered', 'orangered', 'orangered'), color = 'black') +
  theme(axis.text.x = element_text(angle = 90), axis.title.x = element_blank()) +
  labs(y = 'Life expectancy') +
  geom_hline(yintercept = mean(df$life_expectancy), color = 'purple')

bar2
```
\caption{Wykresik}
\end{figure}


# Podsumowanie
